---
title: "IFLS4_cleaning_3_31"
author: "Chenoa Schatzki-McClain"
date: "March 31, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries}
library(foreign)
library(dplyr)
```

```{r load and subset COV section}

#load B3A_COV IFLS4
B3A_COV_4 <- read.dta("C:/Users/cheno/Desktop/IFLS_all/DATA/IFLS4/b3a_cov.dta")

#add year variable and filter to selected vars
B3A_COV_4 <- B3A_COV_4 %>%
                select(pid07, hhid07, pidlink, sex, respndnt, marstat, panel, age) %>%
                mutate(year = 2013)
```

```{r TK section}

#load B3A_TK1 IFLS4
B3A_TK1_4 <- read.dta("C:/Users/cheno/Desktop/IFLS_all/DATA/IFLS4/b3a_tk1.dta")
#subset
B3A_TK1_4 <- B3A_TK1_4 %>%
                select(pid07, hhid07, pidlink, tk01, tk01a, tk03, tk04, tk05, tk06a, tk07)

#load B3A_TK2 IFLS4
B3A_TK2_4 <- read.dta("C:/Users/cheno/Desktop/IFLS_all/DATA/IFLS4/b3a_tk2.dta")
#subset
B3A_TK2_4 <- B3A_TK2_4 %>%
                select(pid07, hhid07, pidlink, tk22a, tk23a, tk24a, tk25a1x, tk25a1, tk25a2)

#load B3A_TK4 IFLS4
B3A_TK4_4 <- read.dta("C:/Users/cheno/Desktop/IFLS_all/DATA/IFLS4/b3a_tk4.dta")
#subset
B3A_TK4_4 <- B3A_TK4_4 %>%
                 select(pid07, hhid07, pidlink, tk46a, tk46b, tk46c, tk46dm, tk46dy, tk46m)

#merge TK files

#TK 1 and 2 include all of the same respondents
TK_merge <- inner_join(B3A_TK1_4, B3A_TK2_4, on = c("hhid00", "pidlink"))

TK_merge <- left_join(TK_merge, B3A_TK4_4, on = c("hhid00", "pidlink"))

#individuals not matched in TK4 are all individuals who have never worked or who have not worked since 1999
TK4_missing <- TK_merge[!(TK_merge$pidlink %in% B3A_TK4_4$pidlink | TK_merge$tk05 ==3 | TK_merge$tk06a == 3),] 

```

```{r B3A_DL2}

#load
B3A_DL2_4 <- read.dta("C:/Users/cheno/Desktop/IFLS_all/DATA/IFLS4/b3a_dl2.dta")

#subset
B3A_DL2_4 <- B3A_DL2_4 %>%
                select(pid07, hhid07, pidlink, dl2type)


#load
B3A_DL1_4 <- read.dta("C:/Users/cheno/Desktop/IFLS_all/DATA/IFLS4/b3a_dl1.dta")

#subset
B3A_DL1_4 <- B3A_DL1_4 %>%
                select(pid07, hhid07, pidlink, dl06x, dl06)


```

```{r B3A_BR1}

#load
B3A_BR1_4 <- read.dta("C:/Users/cheno/Desktop/IFLS_all/DATA/IFLS4/b3a_br1.dta")

#subset
B3A_BR1_4<- B3A_BR1_4 %>%
                select(pid07, hhid07, pidlink, br03, br04)

```

```{r  merge}

#first merge cov with tk
merged <- full_join(B3A_COV_4, TK_merge, on = c("hhid07", "pidlink"))

missing1 <- merged[!(merged$pidlink %in% TK_merge$pidlink),] 

#merge BR1 > all matched
merged <- full_join(merged, B3A_BR1_4, on = c("hhid07", "pidlink"))

# merge DL1 > all matched
merged <- full_join(merged, B3A_DL1_4, on = c("hhid07", "pidlink"))

#remove observation w/ pidlink == NA
#merged <- merged %>%
 #             filter(!(is.na(merged$pidlink)))

```